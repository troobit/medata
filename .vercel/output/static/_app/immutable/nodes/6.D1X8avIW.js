var Je=Object.defineProperty;var He=(O,t,n)=>t in O?Je(O,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):O[t]=n;var Oe=(O,t,n)=>He(O,typeof t!="symbol"?t+"":t,n);import{f as B,a as T,b as Ge,c as ze,t as de}from"../chunks/kKy66PDH.js";import{p as he,c as r,g as e,h as q,k as u,s as i,r as a,n as ee,t as z,a as ye,j as Be,u as W,f as Ae,i as Ve,e as We,$ as qe}from"../chunks/DTv0fGkk.js";import{s as C}from"../chunks/9Aoxbd_n.js";import{i as Y}from"../chunks/CLGhL_wd.js";import{e as ke,i as Ie}from"../chunks/e5qBh1E7.js";import{h as Xe}from"../chunks/C8_siECv.js";import{s as ge}from"../chunks/D-fc9hNp.js";import{g as Ye}from"../chunks/Bm5o5tlR.js";import{L as Fe}from"../chunks/X_0Vvn7d.js";import{B as ce}from"../chunks/NoJzPs2l.js";import{a as H,r as fe,b as Qe}from"../chunks/BjHF3nwv.js";import{d as Se,e as Re}from"../chunks/CEtxWd_S.js";import{b as Ze}from"../chunks/CaAXuPnP.js";import{p as je}from"../chunks/CRGBfSix.js";import{b as Me}from"../chunks/Do8t-uj2.js";import{s as Ee,e as $e}from"../chunks/Dvvmo4p2.js";var et=B('<div role="button"><input type="file" accept="image/*" capture="environment" class="hidden"/> <div class="flex flex-col items-center justify-center px-6 py-12"><div class="mb-4 flex h-16 w-16 items-center justify-center rounded-full bg-gray-800 text-3xl"><svg class="h-8 w-8 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"></path></svg></div> <p class="mb-2 text-center text-lg font-medium text-white"> </p> <p class="mb-4 text-center text-sm text-gray-400">Take a photo or select from gallery</p> <div class="flex gap-4"><button type="button" class="rounded-lg bg-brand-accent px-4 py-2 text-sm font-medium text-gray-950 transition-colors hover:bg-brand-accent/90">Choose Image</button></div> <p class="mt-4 text-xs text-gray-500">Supports Freestyle Libre, Dexcom G6/G7, Medtronic</p></div></div>');function tt(O,t){he(t,!0);let n=je(t,"disabled",3,!1),c=q(null),d=q(!1);function g(_){var I;const A=(I=_.target.files)==null?void 0:I[0];A&&h(A)}function s(_){var A,I;_.preventDefault(),u(d,!1);const k=(I=(A=_.dataTransfer)==null?void 0:A.files)==null?void 0:I[0];k&&k.type.startsWith("image/")&&h(k)}function m(_){_.preventDefault(),u(d,!0)}function x(){u(d,!1)}function h(_){if(!_.type.startsWith("image/"))return;const k=URL.createObjectURL(_);t.onImageSelected(_,k)}function b(){var _;(_=e(c))==null||_.click()}var p=et();p.__click=()=>!n()&&b();var w=r(p);w.__change=g,Ze(w,_=>u(c,_),()=>e(c));var L=i(w,2),P=i(r(L),2),F=r(P,!0);a(P);var E=i(P,4),N=r(E);N.__click=_=>{_.stopPropagation(),b()},a(E),ee(2),a(L),a(p),z(()=>{ge(p,1,`relative rounded-xl border-2 border-dashed transition-colors ${e(d)?"border-brand-accent bg-brand-accent/10":"border-gray-700 bg-gray-900/50"} ${n()?"opacity-50 cursor-not-allowed":""}`),H(p,"tabindex",n()?-1:0),w.disabled=n(),C(F,e(d)?"Drop image here":"Upload CGM Screenshot"),N.disabled=n()}),Re("drop",p,s),Re("dragover",p,m),Re("dragleave",p,x),Re("keypress",p,_=>_.key==="Enter"&&!n()&&b()),T(O,p),ye()}Se(["click","change"]);Se(["click","mousedown","mousemove","mouseup","touchstart","touchmove","touchend"]);var at=B('<div class="space-y-4 rounded-lg border border-gray-700 bg-gray-900/50 p-4"><div class="flex items-center justify-between"><h3 class="text-sm font-medium text-white">Axis Configuration</h3> <span class="text-xs text-gray-500">Adjust if detection is incorrect</span></div> <div class="grid grid-cols-2 gap-4"><div><label for="time-start" class="mb-1 block text-xs text-gray-400">Start Time</label> <input id="time-start" type="time" class="w-full rounded-lg border border-gray-700 bg-gray-800 px-3 py-2 text-sm text-white focus:border-brand-accent focus:outline-none disabled:opacity-50"/></div> <div><label for="time-end" class="mb-1 block text-xs text-gray-400">End Time</label> <input id="time-end" type="time" class="w-full rounded-lg border border-gray-700 bg-gray-800 px-3 py-2 text-sm text-white focus:border-brand-accent focus:outline-none disabled:opacity-50"/></div></div> <div><span id="unit-label" class="mb-1 block text-xs text-gray-400">BSL Unit</span> <div class="grid grid-cols-2 gap-2" role="group" aria-labelledby="unit-label"><button type="button">mmol/L</button> <button type="button">mg/dL</button></div></div> <div class="grid grid-cols-2 gap-4"><div><label for="bsl-min" class="mb-1 block text-xs text-gray-400"> </label> <input id="bsl-min" type="number" class="w-full rounded-lg border border-gray-700 bg-gray-800 px-3 py-2 text-sm text-white focus:border-brand-accent focus:outline-none disabled:opacity-50"/></div> <div><label for="bsl-max" class="mb-1 block text-xs text-gray-400"> </label> <input id="bsl-max" type="number" class="w-full rounded-lg border border-gray-700 bg-gray-800 px-3 py-2 text-sm text-white focus:border-brand-accent focus:outline-none disabled:opacity-50"/></div></div> <p class="text-xs text-gray-500"> </p></div>');function rt(O,t){he(t,!0);let n=je(t,"disabled",3,!1),c=q(""),d=q(""),g=q(0),s=q(0),m=q("mmol/L");function x(l){const v=l.getHours().toString().padStart(2,"0"),f=l.getMinutes().toString().padStart(2,"0");return`${v}:${f}`}function h(l,v){const[f,R]=l.split(":").map(Number),y=new Date(v);return y.setHours(f,R,0,0),y}function b(){const l=t.ranges.timeStart,v={timeStart:h(e(c),l),timeEnd:h(e(d),l),bslMin:e(g),bslMax:e(s),unit:e(m)};v.timeEnd<=v.timeStart&&(v.timeEnd=new Date(v.timeEnd.getTime()+1440*60*1e3)),t.onRangesChanged(v)}Be(()=>{u(c,x(t.ranges.timeStart),!0),u(d,x(t.ranges.timeEnd),!0),u(g,t.ranges.bslMin,!0),u(s,t.ranges.bslMax,!0),u(m,t.ranges.unit,!0)});const p={"mmol/L":{min:2,max:25,step:.5,typical:{min:2,max:15}},"mg/dL":{min:36,max:450,step:5,typical:{min:40,max:400}}};function w(l){l!==e(m)&&(u(m,l,!0),l==="mg/dL"?(u(g,Math.round(e(g)*18),!0),u(s,Math.round(e(s)*18),!0)):(u(g,Math.round(e(g)/18*10)/10),u(s,Math.round(e(s)/18*10)/10)),b())}var L=at(),P=i(r(L),2),F=r(P),E=i(r(F),2);fe(E),E.__change=b,a(F);var N=i(F,2),_=i(r(N),2);fe(_),_.__change=b,a(N),a(P);var k=i(P,2),A=i(r(k),2),I=r(A);I.__click=()=>w("mmol/L");var te=i(I,2);te.__click=()=>w("mg/dL"),a(A),a(k);var Q=i(k,2),ae=r(Q),X=r(ae),ie=r(X);a(X);var U=i(X,2);fe(U),U.__change=b,a(ae);var oe=i(ae,2),re=r(oe),se=r(re);a(re);var S=i(re,2);fe(S),S.__change=b,a(oe),a(Q);var j=i(Q,2),o=r(j);a(j),a(L),z(()=>{E.disabled=n(),_.disabled=n(),ge(I,1,`rounded-lg px-3 py-2 text-sm font-medium transition-colors ${e(m)==="mmol/L"?"bg-brand-accent text-gray-950":"bg-gray-800 text-gray-300 hover:bg-gray-700"}`),I.disabled=n(),ge(te,1,`rounded-lg px-3 py-2 text-sm font-medium transition-colors ${e(m)==="mg/dL"?"bg-brand-accent text-gray-950":"bg-gray-800 text-gray-300 hover:bg-gray-700"}`),te.disabled=n(),C(ie,`Min BSL (${e(m)??""})`),H(U,"min",p[e(m)].min),H(U,"max",e(s)-p[e(m)].step),H(U,"step",p[e(m)].step),U.disabled=n(),C(se,`Max BSL (${e(m)??""})`),H(S,"min",e(g)+p[e(m)].step),H(S,"max",p[e(m)].max),H(S,"step",p[e(m)].step),S.disabled=n(),C(o,`Typical CGM range: ${p[e(m)].typical.min??""} - ${p[e(m)].typical.max??""} ${e(m)??""}`)}),Me(E,()=>e(c),l=>u(c,l)),Me(_,()=>e(d),l=>u(d,l)),Me(U,()=>e(g),l=>u(g,l)),Me(S,()=>e(s),l=>u(s,l)),T(O,L),ye()}Se(["change","click"]);var nt=Ge('<circle r="0.8" stroke="white" stroke-width="0.2"></circle>'),it=Ge('<path fill="none" stroke="rgba(0,0,0,0.5)" stroke-width="0.8" stroke-linecap="round" stroke-linejoin="round" vector-effect="non-scaling-stroke"></path><path fill="none" stroke="#22c55e" stroke-width="0.5" stroke-linecap="round" stroke-linejoin="round" vector-effect="non-scaling-stroke"></path><!>',1),st=B("<li> </li>"),ot=B('<div class="rounded-lg border border-yellow-500/50 bg-yellow-500/10 px-4 py-3"><p class="mb-1 text-sm font-medium text-yellow-400">Warnings:</p> <ul class="list-inside list-disc text-sm text-yellow-300/80"></ul></div>'),lt=B('<div class="space-y-4"><div class="relative overflow-hidden rounded-lg"><img alt="CGM graph with extracted curve" class="w-full"/> <svg class="pointer-events-none absolute inset-0 h-full w-full" viewBox="0 0 100 100" preserveAspectRatio="none"><!></svg> <div class="absolute bottom-2 right-2 rounded bg-black/70 px-2 py-1 text-xs text-white"><span class="mr-2 inline-block h-2 w-2 rounded-full bg-green-500"></span> Extracted curve</div></div> <div class="grid grid-cols-2 gap-3 sm:grid-cols-4"><div class="rounded-lg bg-gray-800 px-3 py-2 text-center"><p class="text-xs text-gray-400">Device</p> <p class="text-sm font-medium text-white"> </p></div> <div class="rounded-lg bg-gray-800 px-3 py-2 text-center"><p class="text-xs text-gray-400">Time Range</p> <p class="text-sm font-medium text-white"> </p></div> <div class="rounded-lg bg-gray-800 px-3 py-2 text-center"><p class="text-xs text-gray-400">Data Points</p> <p class="text-sm font-medium text-white"> </p></div> <div class="rounded-lg bg-gray-800 px-3 py-2 text-center"><p class="text-xs text-gray-400">Confidence</p> <p> </p></div></div> <div class="rounded-lg border border-gray-700 bg-gray-900/50 px-4 py-3"><div class="flex items-center justify-between text-sm"><span class="text-gray-400">BSL Range:</span> <span class="font-medium text-white"> </span></div></div> <!></div>');function dt(O,t){he(t,!0);const n=W(()=>{const{axisRanges:S,dataPoints:j,graphRegion:o}=t.extractionResult;if(j.length<2)return"";const l=S.timeEnd.getTime()-S.timeStart.getTime(),v=S.bslMax-S.bslMin,f=j.map(y=>{const K=(y.timestamp.getTime()-S.timeStart.getTime())/l,D=(y.value-S.bslMin)/v,Z=o.x+K*o.width,V=o.y+(1-D)*o.height;return{x:Z,y:V,confidence:y.confidence}});let R=`M ${f[0].x} ${f[0].y}`;for(let y=1;y<f.length;y++)R+=` L ${f[y].x} ${f[y].y}`;return R}),c=W(()=>`${t.extractionResult.axisRanges.timeStart.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})} - ${t.extractionResult.axisRanges.timeEnd.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}`),d=W(()=>t.extractionResult.dataPoints.length>0?Math.round(t.extractionResult.dataPoints.reduce((S,j)=>S+j.confidence,0)/t.extractionResult.dataPoints.length*100):0),g={"freestyle-libre":"Freestyle Libre",dexcom:"Dexcom",medtronic:"Medtronic",generic:"Generic CGM"};var s=lt(),m=r(s),x=r(m),h=i(x,2),b=r(h);{var p=S=>{var j=it(),o=Ae(j),l=i(o),v=i(l);ke(v,17,()=>t.extractionResult.dataPoints,Ie,(f,R,y)=>{const K=W(()=>t.extractionResult.axisRanges.timeEnd.getTime()-t.extractionResult.axisRanges.timeStart.getTime()),D=W(()=>t.extractionResult.axisRanges.bslMax-t.extractionResult.axisRanges.bslMin),Z=W(()=>(e(R).timestamp.getTime()-t.extractionResult.axisRanges.timeStart.getTime())/e(K)),V=W(()=>(e(R).value-t.extractionResult.axisRanges.bslMin)/e(D)),me=W(()=>t.extractionResult.graphRegion.x+e(Z)*t.extractionResult.graphRegion.width),Te=W(()=>t.extractionResult.graphRegion.y+(1-e(V))*t.extractionResult.graphRegion.height);var be=ze(),_e=Ae(be);{var we=ue=>{var M=nt();z(()=>{H(M,"cx",e(me)),H(M,"cy",e(Te)),H(M,"fill",e(R).confidence>.7?"#22c55e":"#eab308")}),T(ue,M)};Y(_e,ue=>{y%3===0&&ue(we)})}T(f,be)}),z(()=>{H(o,"d",e(n)),H(l,"d",e(n))}),T(S,j)};Y(b,S=>{e(n)&&S(p)})}a(h),ee(2),a(m);var w=i(m,2),L=r(w),P=i(r(L),2),F=r(P,!0);a(P),a(L);var E=i(L,2),N=i(r(E),2),_=r(N,!0);a(N),a(E);var k=i(E,2),A=i(r(k),2),I=r(A,!0);a(A),a(k);var te=i(k,2),Q=i(r(te),2),ae=r(Q);a(Q),a(te),a(w);var X=i(w,2),ie=r(X),U=i(r(ie),2),oe=r(U);a(U),a(ie),a(X);var re=i(X,2);{var se=S=>{var j=ot(),o=i(r(j),2);ke(o,21,()=>t.extractionResult.warnings,Ie,(l,v)=>{var f=st(),R=r(f,!0);a(f),z(()=>C(R,e(v))),T(l,f)}),a(o),a(j),T(S,j)};Y(re,S=>{t.extractionResult.warnings&&t.extractionResult.warnings.length>0&&S(se)})}a(s),z(()=>{H(x,"src",t.imageUrl),C(F,g[t.extractionResult.deviceType]||t.extractionResult.deviceType),C(_,e(c)),C(I,t.extractionResult.dataPoints.length),ge(Q,1,`text-sm font-medium ${e(d)>=80?"text-green-400":e(d)>=60?"text-yellow-400":"text-red-400"}`),C(ae,`${e(d)??""}%`),C(oe,`${t.extractionResult.axisRanges.bslMin??""} - ${t.extractionResult.axisRanges.bslMax??""}
        ${t.extractionResult.axisRanges.unit??""}`)}),T(O,s),ye()}var ct=B('<tr class="border-t border-gray-800 hover:bg-gray-800/50"><td class="px-4 py-2 text-sm text-gray-300"> </td><td class="px-4 py-2 text-right"><input type="number" class="w-16 rounded border border-gray-700 bg-gray-800 px-2 py-1 text-right text-sm text-white focus:border-brand-accent focus:outline-none"/></td><td> </td><td class="px-4 py-2 text-right"><button type="button" class="text-gray-500 hover:text-red-400" aria-label="Remove data point"><svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button></td></tr>'),gt=B('<div class="border-t border-gray-700 px-4 py-2"><button type="button" class="w-full text-center text-sm text-brand-accent hover:underline"> </button></div>'),mt=B('<div class="space-y-4"><div class="grid grid-cols-4 gap-2"><div class="rounded-lg bg-gray-800 px-3 py-2 text-center"><p class="text-xs text-gray-400">Min</p> <p class="text-lg font-bold text-white"> <span class="text-xs font-normal text-gray-400"> </span></p></div> <div class="rounded-lg bg-gray-800 px-3 py-2 text-center"><p class="text-xs text-gray-400">Avg</p> <p class="text-lg font-bold text-white"> <span class="text-xs font-normal text-gray-400"> </span></p></div> <div class="rounded-lg bg-gray-800 px-3 py-2 text-center"><p class="text-xs text-gray-400">Max</p> <p class="text-lg font-bold text-white"> <span class="text-xs font-normal text-gray-400"> </span></p></div> <div class="rounded-lg bg-gray-800 px-3 py-2 text-center"><p class="text-xs text-gray-400">TIR</p> <p> </p></div></div> <div class="rounded-lg border border-gray-700 bg-gray-900/50"><div class="border-b border-gray-700 px-4 py-3"><div class="flex items-center justify-between"><h3 class="text-sm font-medium text-white"> </h3> <span class="text-xs text-gray-500">Tap values to edit</span></div></div> <div class="max-h-64 overflow-y-auto"><table class="w-full"><thead class="sticky top-0 bg-gray-900"><tr class="text-xs text-gray-400"><th class="px-4 py-2 text-left">Time</th><th class="px-4 py-2 text-right"> </th><th class="px-4 py-2 text-right">Conf.</th><th class="px-4 py-2 text-right"></th></tr></thead><tbody></tbody></table></div> <!></div> <p class="text-center text-xs text-gray-500">Data will be imported with source: "cgm-image"</p> <div class="flex gap-3"><!> <!></div></div>');function ut(O,t){he(t,!0);let n=je(t,"loading",3,!1),c=q(Ve([])),d=q(!1);Be(()=>{u(c,[...t.dataPoints],!0)});const g=W(()=>e(d)?e(c):e(c).slice(0,12)),s=W(()=>{const M=e(c).map(ne=>ne.value),J=Math.min(...M),G=Math.max(...M),$=M.reduce((ne,Ce)=>ne+Ce,0)/M.length,ve=t.axisRanges.unit==="mmol/L"?4:72,Pe=t.axisRanges.unit==="mmol/L"?10:180,pe=M.filter(ne=>ne>=ve&&ne<=Pe).length,le=Math.round(pe/M.length*100);return{min:J.toFixed(1),max:G.toFixed(1),avg:$.toFixed(1),tirPercent:le,totalPoints:e(c).length}});function m(M){return M.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}function x(M,J){u(c,e(c).map((G,$)=>$===M?{...G,value:J,confidence:1}:G),!0)}function h(M){u(c,e(c).filter((J,G)=>G!==M),!0)}function b(){t.onConfirm(e(c))}function p(M){return M>=.8?"text-green-400":M>=.6?"text-yellow-400":"text-red-400"}var w=mt(),L=r(w),P=r(L),F=i(r(P),2),E=r(F),N=i(E),_=r(N,!0);a(N),a(F),a(P);var k=i(P,2),A=i(r(k),2),I=r(A),te=i(I),Q=r(te,!0);a(te),a(A),a(k);var ae=i(k,2),X=i(r(ae),2),ie=r(X),U=i(ie),oe=r(U,!0);a(U),a(X),a(ae);var re=i(ae,2),se=i(r(re),2),S=r(se);a(se),a(re),a(L);var j=i(L,2),o=r(j),l=r(o),v=r(l),f=r(v);a(v),ee(2),a(l),a(o);var R=i(o,2),y=r(R),K=r(y),D=r(K),Z=i(r(D)),V=r(Z);a(Z),ee(2),a(D),a(K);var me=i(K);ke(me,23,()=>e(g),M=>M.timestamp.getTime(),(M,J,G)=>{var $=ct(),ve=r($),Pe=r(ve,!0);a(ve);var pe=i(ve),le=r(pe);fe(le),le.__change=Le=>x(e(d)?e(G):e(G),parseFloat(Le.target.value)),a(pe);var ne=i(pe),Ce=r(ne);a(ne);var De=i(ne),Ne=r(De);Ne.__click=()=>h(e(d)?e(G):e(G)),a(De),a($),z((Le,Ke,Ue)=>{C(Pe,Le),Qe(le,e(J).value),H(le,"step",t.axisRanges.unit==="mmol/L"?.1:1),H(le,"min",t.axisRanges.bslMin),H(le,"max",t.axisRanges.bslMax),ge(ne,1,`px-4 py-2 text-right text-sm ${Ke??""}`),C(Ce,`${Ue??""}%`)},[()=>m(e(J).timestamp),()=>p(e(J).confidence),()=>Math.round(e(J).confidence*100)]),T(M,$)}),a(me),a(y),a(R);var Te=i(R,2);{var be=M=>{var J=gt(),G=r(J);G.__click=()=>u(d,!e(d));var $=r(G,!0);a(G),a(J),z(()=>C($,e(d)?"Show less":`Show all ${e(c).length} points`)),T(M,J)};Y(Te,M=>{e(c).length>12&&M(be)})}a(j);var _e=i(j,4),we=r(_e);ce(we,{variant:"secondary",class:"flex-1",get onclick(){return t.onCancel},get disabled(){return n()},children:(M,J)=>{ee();var G=de("Cancel");T(M,G)},$$slots:{default:!0}});var ue=i(we,2);{let M=W(()=>e(c).length===0);ce(ue,{variant:"primary",class:"flex-1",onclick:b,get disabled(){return e(M)},get loading(){return n()},children:(J,G)=>{ee();var $=de();z(()=>C($,`Import ${e(c).length??""} Readings`)),T(J,$)},$$slots:{default:!0}})}a(_e),a(w),z(()=>{C(E,`${e(s).min??""} `),C(_,t.axisRanges.unit),C(I,`${e(s).avg??""} `),C(Q,t.axisRanges.unit),C(ie,`${e(s).max??""} `),C(oe,t.axisRanges.unit),ge(se,1,`text-lg font-bold ${e(s).tirPercent>=70?"text-green-400":e(s).tirPercent>=50?"text-yellow-400":"text-red-400"}`),C(S,`${e(s).tirPercent??""}%`),C(f,`Data Points (${e(s).totalPoints??""})`),C(V,`BSL (${t.axisRanges.unit??""})`)}),T(O,w),ye()}Se(["change","click"]);const xe=`Analyze this CGM (Continuous Glucose Monitor) graph image and extract the blood sugar readings.

Instructions:
1. Identify the graph type (Freestyle Libre, Dexcom, Medtronic, or other)
2. Detect the axis ranges:
   - Time axis: start and end times
   - Y-axis: minimum and maximum BSL values and unit (mmol/L or mg/dL)
3. Trace the glucose curve and extract data points at regular intervals (approximately every 5 minutes)
4. For each point, estimate the BSL value based on its vertical position

Return a JSON object with this exact structure:
{
  "deviceType": "freestyle-libre" | "dexcom" | "medtronic" | "generic",
  "axisRanges": {
    "timeStartHours": <number of hours from midnight for start>,
    "timeEndHours": <number of hours from midnight for end>,
    "bslMin": <number>,
    "bslMax": <number>,
    "unit": "mmol/L" | "mg/dL"
  },
  "dataPoints": [
    {"minutesFromStart": <number>, "value": <BSL reading>},
    ...
  ],
  "graphRegion": {"x": 0, "y": 0, "width": 100, "height": 100},
  "warnings": ["<any issues or low confidence areas>"]
}

Be precise with values. If you cannot determine exact values, estimate based on visual position relative to axis labels and gridlines.`;class vt{constructor(t){Oe(this,"settings");this.settings=t}getMLConfig(){return this.settings.openaiApiKey?{provider:"openai",apiKey:this.settings.openaiApiKey}:this.settings.claudeApiKey?{provider:"claude",apiKey:this.settings.claudeApiKey}:this.settings.geminiApiKey?{provider:"gemini",apiKey:this.settings.geminiApiKey}:this.settings.foundryEndpoint&&this.settings.foundryApiKey?{provider:"foundry",apiKey:this.settings.foundryApiKey,endpoint:this.settings.foundryEndpoint}:this.settings.ollamaEndpoint?{provider:"ollama",apiKey:"",endpoint:this.settings.ollamaEndpoint}:null}async blobToBase64(t){return new Promise((n,c)=>{const d=new FileReader;d.onloadend=()=>n(d.result),d.onerror=c,d.readAsDataURL(t)})}async callOpenAI(t,n){var s,m;const c=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"},body:JSON.stringify({model:"gpt-4o",messages:[{role:"user",content:[{type:"text",text:xe},{type:"image_url",image_url:{url:t,detail:"high"}}]}],max_tokens:4096,response_format:{type:"json_object"}})});if(!c.ok){const x=await c.text();throw new Error(`OpenAI API error: ${x}`)}const g=(m=(s=(await c.json()).choices[0])==null?void 0:s.message)==null?void 0:m.content;if(!g)throw new Error("No response from OpenAI");return JSON.parse(g)}async callClaude(t,n){var b,p;const c=t.match(/^data:([^;]+);base64,(.+)$/);if(!c)throw new Error("Invalid image data URL format");const[,d,g]=c,s=await fetch("https://api.anthropic.com/v1/messages",{method:"POST",headers:{"x-api-key":n,"Content-Type":"application/json","anthropic-version":"2023-06-01"},body:JSON.stringify({model:"claude-sonnet-4-20250514",max_tokens:4096,messages:[{role:"user",content:[{type:"image",source:{type:"base64",media_type:d,data:g}},{type:"text",text:xe}]}]})});if(!s.ok){const w=await s.text();throw new Error(`Claude API error: ${w}`)}const x=(p=(b=(await s.json()).content)==null?void 0:b[0])==null?void 0:p.text;if(!x)throw new Error("No response from Claude");const h=x.match(/\{[\s\S]*\}/);if(!h)throw new Error("Could not parse JSON from Claude response");return JSON.parse(h[0])}async callGemini(t,n){var h,b,p,w,L;const c=t.match(/^data:([^;]+);base64,(.+)$/);if(!c)throw new Error("Invalid image data URL format");const[,d,g]=c,s=await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${n}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:xe},{inline_data:{mime_type:d,data:g}}]}],generationConfig:{responseMimeType:"application/json"}})});if(!s.ok){const P=await s.text();throw new Error(`Gemini API error: ${P}`)}const x=(L=(w=(p=(b=(h=(await s.json()).candidates)==null?void 0:h[0])==null?void 0:b.content)==null?void 0:p.parts)==null?void 0:w[0])==null?void 0:L.text;if(!x)throw new Error("No response from Gemini");return JSON.parse(x)}async callOllama(t,n){const c=t.match(/^data:[^;]+;base64,(.+)$/);if(!c)throw new Error("Invalid image data URL format");const d=c[1],g=this.settings.ollamaModel||"llava",s=await fetch(`${n}/api/generate`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({model:g,prompt:xe,images:[d],stream:!1,format:"json"})});if(!s.ok){const x=await s.text();throw new Error(`Ollama API error: ${x}`)}const m=await s.json();if(!m.response)throw new Error("No response from Ollama");return JSON.parse(m.response)}async callFoundry(t,n,c){var m,x,h;const d=await fetch(`${c}/chat/completions?api-version=2024-12-01-preview`,{method:"POST",headers:{"api-key":n,"Content-Type":"application/json"},body:JSON.stringify({messages:[{role:"user",content:[{type:"text",text:xe},{type:"image_url",image_url:{url:t,detail:"high"}}]}],max_tokens:4096,response_format:{type:"json_object"}})});if(!d.ok){const b=await d.text();throw new Error(`Azure Foundry API error: ${b}`)}const s=(h=(x=(m=(await d.json()).choices)==null?void 0:m[0])==null?void 0:x.message)==null?void 0:h.content;if(!s)throw new Error("No response from Azure Foundry");return JSON.parse(s)}async extractFromImage(t,n={}){var P,F,E,N,_;const c=performance.now(),d=this.getMLConfig();if(!d)throw new Error("No ML provider configured. Please set up an API key in Settings.");const g=await this.blobToBase64(t);let s;switch(d.provider){case"openai":s=await this.callOpenAI(g,d.apiKey);break;case"claude":s=await this.callClaude(g,d.apiKey);break;case"gemini":s=await this.callGemini(g,d.apiKey);break;case"ollama":s=await this.callOllama(g,d.endpoint);break;case"foundry":s=await this.callFoundry(g,d.apiKey,d.endpoint);break;default:throw new Error(`Unsupported ML provider: ${d.provider}`)}const m=new Date;m.setHours(0,0,0,0);const x={timeStart:((P=n.manualAxisRanges)==null?void 0:P.timeStart)||new Date(m.getTime()+s.axisRanges.timeStartHours*60*60*1e3),timeEnd:((F=n.manualAxisRanges)==null?void 0:F.timeEnd)||new Date(m.getTime()+s.axisRanges.timeEndHours*60*60*1e3),bslMin:((E=n.manualAxisRanges)==null?void 0:E.bslMin)??s.axisRanges.bslMin,bslMax:((N=n.manualAxisRanges)==null?void 0:N.bslMax)??s.axisRanges.bslMax,unit:((_=n.manualAxisRanges)==null?void 0:_.unit)||s.axisRanges.unit},h=n.resampleIntervalMinutes??5,b=[],p=[...s.dataPoints].sort((k,A)=>k.minutesFromStart-A.minutesFromStart);for(const k of p){const A=new Date(x.timeStart.getTime()+k.minutesFromStart*60*1e3),I=k.value>=x.bslMin&&k.value<=x.bslMax;b.push({timestamp:A,value:k.value,confidence:I?.9:.5})}const w=this.resampleDataPoints(b,x,h),L=performance.now()-c;return{deviceType:n.deviceType||s.deviceType,axisRanges:x,dataPoints:w,graphRegion:s.graphRegion,extractionMethod:"ml",processingTimeMs:L,warnings:s.warnings}}resampleDataPoints(t,n,c){if(t.length<2)return t;const d=[],g=n.timeStart.getTime(),s=n.timeEnd.getTime(),m=c*60*1e3;for(let x=g;x<=s;x+=m){let h=null,b=null;for(const p of t){const w=p.timestamp.getTime();w<=x&&(!h||w>h.timestamp.getTime())&&(h=p),w>=x&&(!b||w<b.timestamp.getTime())&&(b=p)}if(h&&b){const p=h.timestamp.getTime(),w=b.timestamp.getTime();let L,P;if(p===w)L=h.value,P=h.confidence;else{const F=(x-p)/(w-p);L=h.value+F*(b.value-h.value),P=Math.min(h.confidence,b.confidence)*(1-.1*F)}d.push({timestamp:new Date(x),value:Math.round(L*10)/10,confidence:P})}else h&&d.push({timestamp:new Date(x),value:h.value,confidence:h.confidence*.8})}return d}async detectDeviceType(t){return(await this.extractFromImage(t)).deviceType}async detectAxisRanges(t,n){return(await this.extractFromImage(t)).axisRanges}isSupported(t){return["freestyle-libre","dexcom","medtronic","generic"].includes(t)}isConfigured(){return this.getMLConfig()!==null}}function pt(O){return new vt(O)}var xt=B("<div></div>"),ft=B('<div class="mb-6 flex items-center justify-center gap-2"></div>'),ht=B('<div class="mb-6 rounded-lg bg-red-500/20 px-4 py-3 text-red-400"><p class="font-medium">Error</p> <p class="text-sm"> </p></div>'),yt=B('<div class="mb-6 rounded-lg border border-yellow-500/50 bg-yellow-500/10 px-4 py-3"><p class="mb-2 font-medium text-yellow-400">ML Provider Required</p> <p class="mb-3 text-sm text-yellow-300/80">CGM graph extraction requires a cloud ML provider (OpenAI, Claude, Gemini, or Ollama).</p> <!></div>'),bt=B('<!> <!> <div class="mt-6 rounded-lg border border-gray-700 bg-gray-900/50 px-4 py-3"><p class="mb-2 text-sm font-medium text-gray-300">Supported formats:</p> <div class="flex flex-wrap gap-2 text-xs"><span class="rounded bg-gray-800 px-2 py-1 text-gray-400">Freestyle Libre</span> <span class="rounded bg-gray-800 px-2 py-1 text-gray-400">Dexcom G6/G7</span> <span class="rounded bg-gray-800 px-2 py-1 text-gray-400">Medtronic</span> <span class="rounded bg-gray-800 px-2 py-1 text-gray-400">Generic CGM</span></div></div>',1),_t=B('<div class="flex flex-col items-center justify-center py-12"><!> <p class="mt-4 text-lg font-medium text-white">Extracting BSL Data...</p> <p class="mt-2 text-sm text-gray-400"> </p></div>'),wt=B('<div class="space-y-6"><!> <!> <div class="flex gap-3"><!> <!></div></div>'),Rt=B('<div class="flex flex-col items-center justify-center py-12"><!> <p class="mt-4 text-lg font-medium text-white">Importing Data...</p> <p class="mt-2 text-sm text-gray-400"> </p></div>'),Mt=B('<div class="flex flex-col items-center justify-center py-12 text-center"><div class="mb-6 flex h-20 w-20 items-center justify-center rounded-full bg-green-500/20 text-4xl"><svg class="h-10 w-10 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg></div> <h2 class="mb-2 text-xl font-semibold text-white">Import Complete!</h2> <p class="mb-6 text-gray-400"> </p> <div class="flex gap-3"><!> <!></div></div>'),kt=B('<div class="min-h-[calc(100dvh-80px)] px-4 py-6"><header class="mb-6"><a href="/import" class="mb-4 inline-flex items-center text-gray-400 hover:text-gray-200"><svg class="mr-2 h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg> Back</a> <h1 class="text-2xl font-bold text-white">CGM Graph Import</h1> <p class="mt-1 text-sm text-gray-400">Extract BSL data from CGM app screenshots</p></header> <!> <!> <!> <!> <!> <!> <!> <!></div>');function Jt(O,t){he(t,!0);let n=q("upload"),c=q(null),d=q(null),g=q(null),s=q(null);const m=W(()=>Ee.isMLConfigured);function x(o,l){u(c,o,!0),u(d,l,!0),u(s,null),h()}async function h(){if(e(c)){u(n,"extracting"),u(s,null);try{const o=pt(Ee.settings);if(!o.isConfigured())throw new Error("No ML provider configured. Please set up an API key in Settings.");u(g,await o.extractFromImage(e(c)),!0),u(n,"preview")}catch(o){u(s,o instanceof Error?o.message:"Failed to extract data from image",!0),u(n,"upload")}}}function b(o){e(g)&&u(g,{...e(g),axisRanges:o},!0)}function p(){u(n,"confirm")}async function w(o){var l,v;u(n,"importing"),u(s,null);try{const f=((l=e(g))==null?void 0:l.axisRanges.unit)||"mmol/L",R=((v=e(g))==null?void 0:v.deviceType)||"generic";for(const y of o)await $e.logBSLWithMetadata(y.value,{unit:f,source:"cgm-image",device:R==="freestyle-libre"?"Freestyle Libre":R==="dexcom"?"Dexcom":R==="medtronic"?"Medtronic":"CGM"},y.timestamp);u(n,"complete")}catch(f){u(s,f instanceof Error?f.message:"Failed to import data",!0),u(n,"confirm")}}function L(){e(n)==="confirm"?u(n,"preview"):P()}function P(){u(n,"upload"),u(c,null),e(d)&&URL.revokeObjectURL(e(d)),u(d,null),u(g,null),u(s,null)}function F(){Ye("/history")}var E=kt();Xe("1pnsg2k",o=>{We(()=>{qe.title="CGM Graph Import - MeData"})});var N=i(r(E),2);{var _=o=>{var l=ft();ke(l,20,()=>["upload","extracting","preview","confirm"],Ie,(v,f,R)=>{var y=xt();z(K=>ge(y,1,`h-2 w-2 rounded-full ${K??""}`),[()=>["upload","extracting","preview","confirm"].indexOf(e(n))>=R?"bg-brand-accent":"bg-gray-700"]),T(v,y)}),a(l),T(o,l)};Y(N,o=>{e(n)!=="upload"&&e(n)!=="complete"&&o(_)})}var k=i(N,2);{var A=o=>{var l=ht(),v=i(r(l),2),f=r(v,!0);a(v),a(l),z(()=>C(f,e(s))),T(o,l)};Y(k,o=>{e(s)&&o(A)})}var I=i(k,2);{var te=o=>{var l=bt(),v=Ae(l);{var f=y=>{var K=yt(),D=i(r(K),4);ce(D,{href:"/settings",variant:"secondary",size:"sm",children:(Z,V)=>{ee();var me=de("Configure in Settings");T(Z,me)},$$slots:{default:!0}}),a(K),T(y,K)};Y(v,y=>{e(m)||y(f)})}var R=i(v,2);{let y=W(()=>!e(m));tt(R,{onImageSelected:x,get disabled(){return e(y)}})}ee(2),T(o,l)};Y(I,o=>{e(n)==="upload"&&o(te)})}var Q=i(I,2);{var ae=o=>{var l=_t(),v=r(l);Fe(v,{});var f=i(v,4),R=r(f);a(f),a(l),z(()=>C(R,`Analyzing graph with ${(Ee.configuredProvider||"ML")??""}`)),T(o,l)};Y(Q,o=>{e(n)==="extracting"&&o(ae)})}var X=i(Q,2);{var ie=o=>{var l=wt(),v=r(l);dt(v,{get imageUrl(){return e(d)},get extractionResult(){return e(g)}});var f=i(v,2);rt(f,{get ranges(){return e(g).axisRanges},onRangesChanged:b});var R=i(f,2),y=r(R);ce(y,{variant:"secondary",class:"flex-1",onclick:P,children:(D,Z)=>{ee();var V=de("Start Over");T(D,V)},$$slots:{default:!0}});var K=i(y,2);ce(K,{variant:"primary",class:"flex-1",onclick:p,children:(D,Z)=>{ee();var V=de("Review Data Points");T(D,V)},$$slots:{default:!0}}),a(R),a(l),T(o,l)};Y(X,o=>{e(n)==="preview"&&e(g)&&e(d)&&o(ie)})}var U=i(X,2);{var oe=o=>{ut(o,{get dataPoints(){return e(g).dataPoints},get axisRanges(){return e(g).axisRanges},onConfirm:w,onCancel:L})};Y(U,o=>{e(n)==="confirm"&&e(g)&&o(oe)})}var re=i(U,2);{var se=o=>{var l=Rt(),v=r(l);Fe(v,{});var f=i(v,4),R=r(f);a(f),a(l),z(()=>{var y;return C(R,`Saving ${(((y=e(g))==null?void 0:y.dataPoints.length)||0)??""} BSL readings`)}),T(o,l)};Y(re,o=>{e(n)==="importing"&&o(se)})}var S=i(re,2);{var j=o=>{var l=Mt(),v=i(r(l),4),f=r(v);a(v);var R=i(v,2),y=r(R);ce(y,{variant:"secondary",onclick:P,children:(D,Z)=>{ee();var V=de("Import Another");T(D,V)},$$slots:{default:!0}});var K=i(y,2);ce(K,{variant:"primary",onclick:F,children:(D,Z)=>{ee();var V=de("View History");T(D,V)},$$slots:{default:!0}}),a(R),a(l),z(()=>{var D;return C(f,`Successfully imported ${(((D=e(g))==null?void 0:D.dataPoints.length)||0)??""} BSL readings.`)}),T(o,l)};Y(S,o=>{e(n)==="complete"&&o(j)})}a(E),T(O,E),ye()}export{Jt as component};
